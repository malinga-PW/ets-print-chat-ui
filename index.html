<!DOCTYPE html>
<html>
<head>
<title>ETS_Print Chat UI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; background:#f3f3f3; margin:0; padding:0; }
.container { display:flex; align-items:center; justify-content:center; height:100vh; }
.chatbox { width:100%; max-width:520px; background:#ffffff; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.08); display:flex; flex-direction:column; height:86vh; overflow:hidden; }
.header { padding:14px 18px; background:linear-gradient(90deg,#0f1724,#1f2a44); color:#fff; font-weight:700; }
.messages { flex:1; padding:16px; overflow-y:auto; background: linear-gradient(#ffffff,#fbfbfb); }
.msg { padding:10px 14px; margin-bottom:10px; border-radius:14px; max-width:85%; line-height:1.4em; box-shadow:0 1px 0 rgba(0,0,0,0.02); }
.you { background:#e6f7ff; align-self:flex-end; }
.ai  { background:#f2f2f2; align-self:flex-start; }
.inputbar { padding:12px; display:flex; gap:10px; border-top:1px solid #eee; }
input[type="text"] { flex:1; padding:10px 12px; border-radius:8px; border:1px solid #ddd; font-size:15px; }
button.send { padding:10px 16px; background:#007bff; color:#fff; border:none; border-radius:8px; cursor:pointer; }
.small { font-size:12px; color:#666; margin-top:6px; text-align:right; padding-right:10px; }
@media (max-width:520px){ .chatbox { height:92vh; border-radius:0; } .header{font-size:15px} }
</style>
</head>
<body>
<div class="container">
  <div class="chatbox" role="application" aria-label="ETS Print Chat UI">
    <div class="header">ETS Print — Chat with AI Designer</div>
    <div id="messages" class="messages" aria-live="polite"></div>

    <div class="inputbar">
      <input id="msg" type="text" placeholder="Type your message (e.g. 'I need a wedding invitation, A5, 100pcs')">
      <button class="send" onclick="send()">Send</button>
    </div>
    <div class="small">Connected to ETS_Print Agent</div>
  </div>
</div>

<script>
// Edit this webhook if your n8n webhook path is different
const WEBHOOK = "https://pwagent.app.n8n.cloud/webhook/chat-trigger-webhook";

const sessionId = "staff-" + Math.floor(Math.random()*999999);
const user = "staff";

function addMessage(text, who){
  const el = document.createElement("div");
  el.className = "msg " + (who==="you"? "you":"ai");
  el.textContent = text;
  document.getElementById("messages").appendChild(el);
  el.scrollIntoView({behavior:"smooth", block:"end"});
}

async function send(){
  const input = document.getElementById("msg");
  const text = input.value && input.value.trim();
  if(!text) return;
  addMessage(text, "you");
  input.value = "";
  try{
    const payload = { sessionId, user, message: text };
    const res = await fetch(WEBHOOK, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });
    // Expecting n8n to return JSON; if not, we fallback to a success message.
    const data = await res.json().catch(()=>null);
    if(data && (data.reply || data.response || data.text)) {
      const reply = data.reply || data.response || data.text;
      addMessage(String(reply), "ai");
    } else {
      addMessage("✔ Message delivered to ETS_Print Agent. Waiting for reply...", "ai");
    }
  } catch(err){
    addMessage("⚠️ Error sending message: " + err.message, "ai");
  }
}
</script>
</body>
</html>
